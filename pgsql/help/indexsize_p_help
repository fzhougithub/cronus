WITH RECURSIVE index_partitions AS (
    SELECT c.oid AS index_oid, c.relname AS index_name
    FROM pg_class c
    JOIN pg_index i ON i.indexrelid = c.oid
    WHERE c.relname = 'claim_core_p1_uniq_idx1'

    UNION ALL

    SELECT c.oid, c.relname
    FROM pg_inherits h
    JOIN pg_class c ON c.oid = h.inhrelid
    JOIN index_partitions p ON p.index_oid = h.inhparent
)
SELECT
    pg_size_pretty(SUM(pg_relation_size(index_oid))) AS total_index_size,
    COUNT(*) AS num_leaf_indexes
FROM index_partitions
WHERE NOT EXISTS (
    SELECT 1 FROM pg_inherits WHERE inhparent = index_oid
);


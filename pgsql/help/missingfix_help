WITH src_cols AS (
  SELECT
      a.attname,
      a.atttypid,
      a.atttypmod,
      a.attnotnull,
      a.attidentity,           -- '' | 'a' (ALWAYS) | 'd' (BY DEFAULT)
      a.attcollation,
      t.typcollation           AS typcollation,
      co.collname,
      ad.adbin,
      ad.adrelid
  FROM pg_attribute a
  JOIN pg_class     c  ON c.oid = a.attrelid
  JOIN pg_namespace ns ON ns.oid = c.relnamespace
  JOIN pg_type      t  ON t.oid = a.atttypid
  LEFT JOIN pg_attrdef ad
         ON ad.adrelid = a.attrelid AND ad.adnum = a.attnum
  LEFT JOIN pg_collation co
         ON co.oid = a.attcollation
  WHERE ns.nspname = 'finance'                 -- <-- SOURCE schema
    AND c.relname = 'ledger_account'           -- <-- SOURCE table
    AND a.attnum > 0
    AND NOT a.attisdropped
    AND a.attname = ANY(ARRAY['customer_id','client_id'])  -- <-- missing columns list
)
SELECT
    'ALTER TABLE ' || 'finance_other.ledger_account' ||      -- <-- TARGET fully-qualified name
    ' ADD COLUMN ' || quote_ident(attname) || ' ' ||
    pg_catalog.format_type(atttypid, atttypmod) ||
    CASE
      WHEN attcollation IS NOT NULL
           AND attcollation <> typcollation
           AND collname IS NOT NULL
      THEN ' COLLATE ' || quote_ident(collname)
      ELSE ''
    END ||
    CASE
      WHEN attidentity = 'a' THEN ' GENERATED ALWAYS AS IDENTITY'
      WHEN attidentity = 'd' THEN ' GENERATED BY DEFAULT AS IDENTITY'
      WHEN adbin IS NOT NULL THEN ' DEFAULT ' || pg_get_expr(adbin, adrelid)
      ELSE ''
    END ||
    CASE WHEN attnotnull THEN ' NOT NULL' ELSE '' END ||
    ';' AS ddl
FROM src_cols
ORDER BY attname;



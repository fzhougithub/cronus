SELECT
    n.nspname AS schema_name,
    c.relname AS table_name,
    c.relkind AS table_type,
    pg_total_relation_size(c.oid)/1024/1024 AS total_bytes,
    pg_size_pretty(pg_total_relation_size(c.oid)) AS total_size
FROM pg_class c
JOIN pg_namespace n ON n.oid = c.relnamespace
WHERE n.nspname = 'claimsprocess_humana'
  AND c.relkind IN ('r', 'p', 't', 'm')  -- r=table, p=partitioned table, t=TOAST, m=materialized view
ORDER BY total_bytes DESC;





SELECT
    child.relname AS partition_name,
    nmsp_child.nspname AS partition_schema,
    pg_size_pretty(pg_total_relation_size(child.oid)) AS partition_size_pretty,
    pg_total_relation_size(child.oid) AS partition_size_bytes
FROM
    pg_inherits
JOIN
    pg_class parent ON pg_inherits.inhparent = parent.oid
JOIN
    pg_class child ON pg_inherits.inhrelid = child.oid
LEFT JOIN
    pg_namespace nmsp_parent ON nmsp_parent.oid = parent.relnamespace
LEFT JOIN
    pg_namespace nmsp_child ON nmsp_child.oid = child.relnamespace
WHERE
    parent.relname = 'claim_core'
ORDER BY
    partition_size_bytes DESC;

SELECT
    'Partition' AS type,
    child.relname AS name,
    nmsp_child.nspname AS schema,
    pg_size_pretty(pg_total_relation_size(child.oid)) AS size_pretty,
    pg_total_relation_size(child.oid) AS size_bytes
FROM
    pg_inherits
JOIN
    pg_class parent ON pg_inherits.inhparent = parent.oid
JOIN
    pg_class child ON pg_inherits.inhrelid = child.oid
LEFT JOIN
    pg_namespace nmsp_parent ON nmsp_parent.oid = parent.relnamespace
LEFT JOIN
    pg_namespace nmsp_child ON nmsp_child.oid = child.relnamespace
WHERE
    parent.relname = 'claim_core'
    -- Optional: specify schema if known:
    -- AND nmsp_parent.nspname = 'claimsprocess'
    
UNION ALL

SELECT
    'Total' AS type,
    'All Partitions' AS name,
    NULL AS schema,
    pg_size_pretty(SUM(pg_total_relation_size(child.oid))) AS size_pretty,
    SUM(pg_total_relation_size(child.oid)) AS size_bytes
FROM
    pg_inherits
JOIN
    pg_class parent ON pg_inherits.inhparent = parent.oid
JOIN
    pg_class child ON pg_inherits.inhrelid = child.oid
LEFT JOIN
    pg_namespace nmsp_parent ON nmsp_parent.oid = parent.relnamespace
LEFT JOIN
    pg_namespace nmsp_child ON nmsp_child.oid = child.relnamespace
WHERE
    parent.relname = 'claim_core';



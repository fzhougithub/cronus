docker --version

Go to https://www.docker.com/products/docker-desktop/
Click "Download for Mac" (auto-detects Apple Silicon or Intel)

I am using MP4, should be apple chip

start the docker app in macos

docker --version
docker run hello-world
docker run -it ubuntu bash


mkdir ~/airflow-docker && cd ~/airflow-docker
mkdir -p dags logs plugins

# Get latest official docker-compose.yaml
curl -LfO 'https://airflow.apache.org/docs/apache-airflow/stable/docker-compose.yaml'

cat > .env << EOF
AIRFLOW_UID=$(id -u)
AIRFLOW_GID=$(id -g)
_AIRFLOW_DB_MIGRATE=1
_AIRFLOW_WWW_USER_USERNAME=airflow
_AIRFLOW_WWW_USER_PASSWORD=airflow
_AIRFLOW_WWW_USER_FIRST_NAME=airflow
_AIRFLOW_WWW_USER_LAST_NAME=User
_AIRFLOW_WWW_USER_ROLE=Admin
_AIRFLOW_WWW_USER_EMAIL=airflow@airflow.com
EOF

source .env

# Start all services
docker compose up airflow-standalone
it does not work, because official airflow has no that standalone service

You need to install the standalone service

mkdir airflow-standalone-demo && cd airflow-standalone-demo
curl -LfO 'https://airflow.apache.org/docs/apache-airflow/2.9.3/docker-compose.yaml'

cat .env
AIRFLOW_UID=502
AIRFLOW_GID=20
_AIRFLOW_DB_MIGRATE=1
_AIRFLOW_WWW_USER_USERNAME=airflow
_AIRFLOW_WWW_USER_PASSWORD=airflow
_AIRFLOW_WWW_USER_FIRST_NAME=airflow
_AIRFLOW_WWW_USER_LAST_NAME=User
_AIRFLOW_WWW_USER_ROLE=Admin
_AIRFLOW_WWW_USER_EMAIL=airflow@airflow.com

docker compose up standalone
This one is production style, still does not work, have to give another try

mkdir ~/airflow-standalone-correct && cd ~/airflow-standalone-correct
curl -LfO 'https://airflow.apache.org/docs/apache-airflow/stable/docker-compose.yaml'
curl -LfO 'https://airflow.apache.org/docs/apache-airflow/2.9.3/docker-compose.yaml'
does not work

Finally, chatgpt said should use stable version
mkdir -p dags logs plugins config
echo -e "AIRFLOW_UID=$(id -u)" > .env
docker compose up airflow-init

docker compose up -d

http://localhost:8080
Default login:
user: airflow
password: airflow

To stop
docker compose down
To stop but keep volumns
docker compose down --volumes

docker compose up -d

docker compose ps
docker compose logs -f airflow-scheduler

docker compose exec airflow-scheduler airflow dags list

docker compose exec airflow-scheduler airflow dags list-import-errors

Since keep getting the DAG loading error, finally need to build customized image

Step 1: in compose project folder, vi requirements.txt

# requirements.txt
apache-airflow-providers-postgres
psycopg2-binary
apache-airflow-providers-standard

create Dockerfile


# Dockerfile
FROM apache/airflow:3.1.3

# Use the airflow user; the image venv allows pip installs at build time
USER airflow

# Use constraints that match the base image to avoid dependency conflicts
ARG AIRFLOW_VERSION=3.1.3
ARG PYTHON_VERSION=3.12

# Official constraints file for your Airflow/Python version (update if you change image)
ARG CONSTRAINT_URL="https://raw.githubusercontent.com/apache/airflow/constraints-${AIRFLOW_VERSION}/constraints-${PYTHON_VERSION}.txt"

COPY requirements.txt /tmp/requirements.txt
RUN pip install --no-cache-dir -r /tmp/requirements.txt \
    --constraint "${CONSTRAINT_URL}"


Then, use the docker-compose.yaml file copilod gave to me

docker compose exec airflow-scheduler airflow dags reserialize

docker compose exec airflow-scheduler airflow dags list | grep list_schemas_sql

docker compose donw
docker compose up --build

Inside the container means

docker compose exec airflow-standalone bash
# OR using container name/ID
docker exec -it airflow-docker_airflow-standalone_1 bash

deepseek:

docker logout

docker pull apache/airflow:2.7.3
docker pull postgres:14
docker compose up airflow-init








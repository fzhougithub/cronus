WITH schema_tables AS (
    SELECT 
        c.oid AS table_oid,
        n.nspname || '.' || c.relname AS full_table_name
    FROM pg_class c
    JOIN pg_namespace n ON n.oid = c.relnamespace
    WHERE n.nspname = 'claimsprocess_humana'
      AND c.relkind = 'r'  -- regular table
      AND NOT EXISTS (  -- Exclude child partitions
          SELECT 1 FROM pg_inherits i 
          WHERE i.inhrelid = c.oid
      )
),
fk_constraints AS (
    SELECT 
        con.conrelid,
        con.conname AS fk_name,
        st.full_table_name
    FROM pg_constraint con
    JOIN schema_tables st ON con.conrelid = st.table_oid
    WHERE con.contype = 'f'
)
SELECT 
    'ALTER TABLE ' || full_table_name || ' DROP CONSTRAINT IF EXISTS ' || fk_name || ';'
FROM fk_constraints
ORDER BY full_table_name, fk_name;

WITH schema_tables AS (
    SELECT 
        c.oid AS table_oid,
        n.nspname || '.' || c.relname AS full_table_name
    FROM pg_class c
    JOIN pg_namespace n ON n.oid = c.relnamespace
    WHERE n.nspname = 'claimsprocess_humana'
      AND c.relkind = 'r'
      AND NOT EXISTS (SELECT 1 FROM pg_inherits i WHERE i.inhrelid = c.oid)
),
fk_constraints AS (
    SELECT 
        con.conrelid,
        con.conname AS fk_name,
        pg_get_constraintdef(con.oid) AS def,
        st.full_table_name
    FROM pg_constraint con
    JOIN schema_tables st ON con.conrelid = st.table_oid
    WHERE con.contype = 'f'
)
SELECT 
    'ALTER TABLE ' || full_table_name || ' ADD CONSTRAINT ' || fk_name || ' ' || def || ';'
FROM fk_constraints
ORDER BY full_table_name, fk_name;



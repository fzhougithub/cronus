Concept:

-- Terminate the wraparound autovacuum (temporarily)
SELECT pg_terminate_backend(4090663);

-- Then immediately run a manual wraparound prevention vacuum
VACUUM (FREEZE, VERBOSE) stg_customer_320.c52;


#!/bin/bash
end_time=$(( $(date +%s) + 600 )) # 10 minutes from now

while [ $(date +%s) -lt $end_time ]; do
  psql -c "
    SELECT pg_terminate_backend(pid)
    FROM pg_stat_activity
    WHERE query LIKE 'autovacuum: % wraparound%'
    AND pid <> pg_backend_pid()
    AND backend_type = 'autovacuum worker'
    AND pid IN (SELECT pid FROM pg_stat_activity);"
  sleep 2
done

--another session;
VACUUM (FREEZE, VERBOSE, DISABLE_PAGE_SKIPPING, PROCESS_TOAST) stg_customer_320.c52;

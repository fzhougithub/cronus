SET statement_timeout = 0;
VACUUM (FREEZE, VERBOSE, DISABLE_PAGE_SKIPPING, PROCESS_TOAST) stg_customer_320.c52;

In another session

-- Keep terminating new autovacuums in a loop
DO $$
DECLARE
  pid int;
BEGIN
  LOOP
    SELECT pg_backend_pid() INTO pid;
    PERFORM pg_sleep(2);
    PERFORM pg_terminate_backend(a.pid)
    FROM pg_stat_activity a
    WHERE a.query LIKE 'autovacuum: % wraparound%'
    AND a.pid <> pid;
  END LOOP;
END $$;

-- Run this in a separate terminal
while true; do
  psql -c "SELECT pg_terminate_backend(pid) 
          FROM pg_stat_activity 
          WHERE query LIKE 'autovacuum: % wraparound%'
          AND pid <> pg_backend_pid();"
  sleep 2
done

DO $$
DECLARE
  pid int; -- Variable to store OUR PID
BEGIN
  LOOP
    -- Get OUR connection's PID (the one running this loop)
    SELECT pg_backend_pid() INTO pid;
    
    -- Wait 5 seconds between checks
    PERFORM pg_sleep(5);
    
    -- Terminate ALL other autovacuum wraparound processes
    PERFORM pg_terminate_backend(a.pid)
    FROM pg_stat_activity a
    WHERE a.query LIKE 'autovacuum: % wraparound%'
    AND a.pid <> pid; -- Don't terminate myself
  END LOOP;
END $$;



dnf update -y

dnf install python3.11 python3.11-devel

python3 -c 'import sys; print(f"{sys.version_info.major}.{sys.version_info.minor}")'
3.11

python3.11 -m venv /pg_backups/airflow/venv
source /pg_backups/airflow/venv/bin/activate


sudo useradd airflow
mkdir /pg_backups/airflow
chown airflow:airflow /pg_backups/airflow

pip install "apache-airflow[celery]==3.1.3" \
  --constraint "https://raw.githubusercontent.com/apache/airflow/constraints-3.1.3/constraints-3.11.txt"

airflow standalone &
# You can run 'pkill -f airflow' to kill it

create service file

/etc/systemd/system/airflow.service
[Unit]
Description=Apache Airflow Standalone Service
After=network.target

[Service]
User=airflow
Group=airflow
Environment=AIRFLOW_HOME=/pg_backups/airflow
ExecStart=/usr/bin/airflow standalone
Restart=always
RestartSec=5
StandardOutput=append:/pg_backups/airflow.log
StandardError=append:/pg_backups/airflow.log

[Install]
WantedBy=multi-user.target


ln -s  /pg_backups/airflow/venv/bin/airflow /usr/bin/airflow

systemctl start airflow


airflow users create \
    --username admin \
    --firstname Admin \
    --lastname User \
    --role Admin \
    --email admin@example.com


airflow standalone

or


airflow webserver --port 8080 &
airflow scheduler &


pip install apache-airflow-providers-apache-kafka apache-airflow-providers-postgres confluent-kafka



docker compose ps

docker exec airflow-postgres psql -U airflow -d airflow -c "SELECT version();"

docker compose up airflow-init

docker compose stop airflow-webserver airflow-scheduler postgres
docker compose down
docker compose up -d



SELECT date_trunc('hour', created_at) AS chunk_start, 
       lead(date_trunc('hour', created_at)) OVER (ORDER BY date_trunc('hour', created_at)) AS chunk_end
FROM big_table

WITH numbered AS (
  SELECT id, row_number() OVER (ORDER BY id) AS rn
  FROM big_table
)
SELECT MIN(id), MAX(id)
FROM numbered
WHERE rn BETWEEN X AND Y;


WITH numbered AS (
  SELECT id, row_number() OVER (ORDER BY created_at, id) AS rn
  FROM big_table
)
SELECT id
FROM numbered
WHERE rn BETWEEN X AND Y;

WITH numbered AS (
  SELECT id, row_number() OVER (ORDER BY created_at, id) AS rn
  FROM big_table
),
chunked AS (
  SELECT
    id,
    rn,
    ((rn - 1) / 100000) + 1 AS chunk_id  -- adjust 100000 to your desired chunk size
  FROM numbered
),
boundaries AS (
  SELECT
    chunk_id,
    MIN(id) AS min_id,
    MAX(id) AS max_id,
    COUNT(*) AS row_count
  FROM chunked
  GROUP BY chunk_id
  ORDER BY chunk_id
)
SELECT * FROM boundaries;


WITH numbered AS (
  SELECT *,
         ROW_NUMBER() OVER (ORDER BY some_stable_column) AS rn
  FROM chunk_map
)
UPDATE chunk_map
SET chunk_id = ((numbered.rn - 1) / 100000) + 1
FROM numbered
WHERE chunk_map.id = numbered.id;



Another solution from microsoft, it is completely naive and garbage. 
1. build temp table
CREATE TEMP TABLE chunk_map AS
SELECT
  id,
  row_number() OVER (ORDER BY created_at, id) AS rn
FROM big_table;


2. alter table add column

-- Add the column
ALTER TABLE chunk_map ADD COLUMN chunk_id INT;

-- Compute total rows first
WITH total AS (
  SELECT COUNT(*) AS cnt FROM chunk_map
)
UPDATE chunk_map
SET chunk_id = ((rn - 1) / (SELECT cnt / 10 FROM total)) + 1;


3. get chunk list
SELECT chunk_id, array_agg(id ORDER BY rn) AS ids
FROM chunk_map
GROUP BY chunk_id
ORDER BY chunk_id;


4. generate copy command?

COPY (
  SELECT * FROM big_table
  WHERE id = ANY ('{uuid1, uuid2, uuid3, ...}')
) TO STDOUT WITH CSV;


5. real copy 

psql -c "
BEGIN;
SET TRANSACTION SNAPSHOT 'your_snapshot_id';
COPY (
  SELECT * FROM big_table
  WHERE id IN (SELECT id FROM chunk_map WHERE chunk_id = $CHUNK)
) TO STDOUT WITH CSV;
COMMIT;
" > chunk_$CHUNK.csv




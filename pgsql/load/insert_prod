\timing on
SET work_mem = '256MB';
begin;

INSERT INTO stg_customer_320.dur (clm_id, cust_id, clnt_id, grp_intl_id, mbr_id, actv_prd_typ, days_sply, fill_dte, mtrc_qnty, rx_nbr, presbr_id, provr_id, provr_affl_id, std_tc_cde, spec_tc_cde_1, spec_tc_cde_2, spec_tc_cde_3, spec_tc_cde_4, spec_tc_cde_5, spec_tc_cde_6, spec_tc_cde_7, gcn, hic_list_cde_1, hic_list_cde_2, hic_list_cde_3, hic_list_cde_4, hic_list_cde_5, hic_list_cde_6, hic_list_cde_7, hic_list_cde_8, hic_list_cde_9, actv_prd_id, rte_adminn_cde, ndc, pharm_stat_indr, pay_educ_indr, gnrc_prod_indr, npi_presbr_id, npi_pharm_id, prcs_actn_indr, prcs_add_user_id, prcs_add_tmsp, prcs_strt_tmsp, prcs_end_tmsp, prcs_usr_id, prcs_pgm_id, adjudn_cde, cms_transtn_cde, pat_locn_cde, lvl_of_serv_cde, dur_cfl_cde, ther_clas_cde_spec, auth_nbr, assocd_clm_id, clm_stat_cde, pharm_id_npi_qlfr, rfl_nbr, ucf_days_sply, gcn_seq_nbr, fdb_hicl_seq_nbr, gnrc_indr, pst_pay_rvw_indr, health_insurance_claim_id, rail_road_benefit_id, prescription_id, submission_clarification_cd, drug_category_cd, coverage_1_cd, coverage_2_cd, copay_at, tier_level_ct, pharm_chain_id, pharmacy_network_id, ahfs_therapeutic_class_id, brand_lng_nm, core_9_cd, generic_therapeutic_class_id, generic_name_tx, med_id, fill_type_cd, domani_migrate_ind)
SELECT
 clm_id::character varying(12),
 cust_id::numeric,
 clnt_id::numeric,
 CASE WHEN trim(BOTH ' ' FROM grp_intl_id) = '' THEN NULL ELSE grp_intl_id::numeric END AS grp_intl_id,
 mbr_id::character varying(18),
 actv_prd_typ::character varying(1),
 CASE WHEN trim(BOTH ' ' FROM days_sply) = '' THEN NULL ELSE days_sply::numeric END AS days_sply,
 CASE WHEN trim(BOTH ' ' FROM fill_dte) = '' THEN NULL ELSE fill_dte::date END AS fill_dte,
 CASE WHEN trim(BOTH ' ' FROM mtrc_qnty) = '' THEN NULL ELSE mtrc_qnty::numeric END AS mtrc_qnty,
 rx_nbr::character varying(8),
 presbr_id::character varying(10),
 CASE WHEN trim(BOTH ' ' FROM provr_id) = '' THEN NULL ELSE provr_id::numeric END AS provr_id,
 CASE WHEN trim(BOTH ' ' FROM provr_affl_id) = '' THEN NULL ELSE provr_affl_id::numeric END AS provr_affl_id,
 std_tc_cde::character varying(2),
 spec_tc_cde_1::character varying(3),
 spec_tc_cde_2::character varying(3),
 spec_tc_cde_3::character varying(3),
 spec_tc_cde_4::character varying(3),
 spec_tc_cde_5::character varying(3),
 spec_tc_cde_6::character varying(3),
 spec_tc_cde_7::character varying(3),
 gcn::character varying(5),
 hic_list_cde_1::character varying(6),
 hic_list_cde_2::character varying(6),
 hic_list_cde_3::character varying(6),
 hic_list_cde_4::character varying(6),
 hic_list_cde_5::character varying(6),
 hic_list_cde_6::character varying(6),
 hic_list_cde_7::character varying(6),
 hic_list_cde_8::character varying(6),
 hic_list_cde_9::character varying(6),
 actv_prd_id::character varying(2),
 rte_adminn_cde::character varying(2),
 ndc::character varying(11),
 pharm_stat_indr::character varying(11),
 pay_educ_indr::character varying(1),
 gnrc_prod_indr::character varying(1),
 npi_presbr_id::character varying(10),
 npi_pharm_id::character varying(10),
 prcs_actn_indr::character varying(1),
 prcs_add_user_id::character varying(8),
 CASE WHEN trim(BOTH ' ' FROM prcs_add_tmsp) = '' THEN NULL ELSE prcs_add_tmsp::timestamp END AS prcs_add_tmsp,
 CASE WHEN trim(BOTH ' ' FROM prcs_strt_tmsp) = '' THEN NULL ELSE prcs_strt_tmsp::timestamp END AS prcs_strt_tmsp,
 CASE WHEN trim(BOTH ' ' FROM prcs_end_tmsp) = '' THEN NULL ELSE prcs_end_tmsp::timestamp END AS prcs_end_tmsp,
 prcs_usr_id::character varying(8),
 prcs_pgm_id::character varying(8),
 adjudn_cde::character varying(2),
 cms_transtn_cde::character varying(2),
 pat_locn_cde::character varying(2),
 lvl_of_serv_cde::character varying(2),
 dur_cfl_cde::character varying(2),
 ther_clas_cde_spec::character varying(3),
 auth_nbr::character varying(20),
 assocd_clm_id::character varying(12),
 clm_stat_cde::character varying(2),
 pharm_id_npi_qlfr::character varying(2),
 CASE WHEN trim(BOTH ' ' FROM rfl_nbr) = '' THEN NULL ELSE rfl_nbr::int2 END AS rfl_nbr,
 CASE WHEN trim(BOTH ' ' FROM ucf_days_sply) = '' THEN NULL ELSE ucf_days_sply::numeric END AS ucf_days_sply,
 CASE WHEN trim(BOTH ' ' FROM gcn_seq_nbr) = '' THEN NULL ELSE gcn_seq_nbr::int4 END AS gcn_seq_nbr,
 CASE WHEN trim(BOTH ' ' FROM fdb_hicl_seq_nbr) = '' THEN NULL ELSE fdb_hicl_seq_nbr::int4 END AS fdb_hicl_seq_nbr,
 gnrc_indr::character varying(1),
 pst_pay_rvw_indr::character varying(1),
 health_insurance_claim_id::character varying(20),
 rail_road_benefit_id::character varying(20),
 CASE WHEN trim(BOTH ' ' FROM prescription_id) = '' THEN NULL ELSE prescription_id::numeric END AS prescription_id,
 CASE WHEN trim(BOTH ' ' FROM submission_clarification_cd) = '' THEN NULL ELSE submission_clarification_cd::numeric END AS submission_clarification_cd,
 drug_category_cd::character varying(2),
 coverage_1_cd::character varying(6),
 coverage_2_cd::character varying(6),
 CASE WHEN trim(BOTH ' ' FROM copay_at) = '' THEN NULL ELSE copay_at::numeric END AS copay_at,
 CASE WHEN trim(BOTH ' ' FROM tier_level_ct) = '' THEN NULL ELSE tier_level_ct::numeric END AS tier_level_ct,
 pharm_chain_id::character varying(7),
 CASE WHEN trim(BOTH ' ' FROM pharmacy_network_id) = '' THEN NULL ELSE pharmacy_network_id::numeric END AS pharmacy_network_id,
 CASE WHEN trim(BOTH ' ' FROM ahfs_therapeutic_class_id) = '' THEN NULL ELSE ahfs_therapeutic_class_id::numeric END AS ahfs_therapeutic_class_id,
 brand_lng_nm::character varying(35),
 core_9_cd::character varying(9),
 CASE WHEN trim(BOTH ' ' FROM generic_therapeutic_class_id) = '' THEN NULL ELSE generic_therapeutic_class_id::numeric END AS generic_therapeutic_class_id,
 generic_name_tx::character varying(40),
 CASE WHEN trim(BOTH ' ' FROM med_id) = '' THEN NULL ELSE med_id::numeric END AS med_id,
 fill_type_cd::character varying(1),
 domani_migrate_ind::character varying(1)
FROM stg_customer_320.dur_tmp
where clm_id::bigint between :startid and :endid;

insert into stg_customer_320.dur_history values(:startid,:endid,now(),'OK');

COMMIT;
